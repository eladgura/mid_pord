<!-- profile.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <style>
        /* Your CSS styles here */
    </style>
</head>
<body>
    <h1>Welcome, <span id="username"></span>!</h1>

    <h2>My Loans</h2>
    <ul id="loans-list"></ul>

    <h2>Late Loans</h2>
    <ul id="late-loans-list"></ul>

    <h2>Change Password</h2>
    <form id="change-password-form">
        <input type="password" name="new_password" placeholder="Enter new password" required>
        <div class="button-container">
            <button type="submit">Change Password</button>
        </div>
    </form>

    <h2>Change Username</h2>
    <form id="change-username-form">
        <input type="text" name="new_username" placeholder="Enter new username" required>
        <div class="button-container">
            <button type="submit">Change Username</button>
        </div>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const headers = {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('access_token')}`
        };

        // Fetch user profile
        axios.get('http://localhost:5000/api/profile', { headers })
            .then(response => {
                const user = response.data.user;
                document.getElementById('username').textContent = user.username;

                // Display loans
                const loansList = document.getElementById('loans-list');
                user.loans.forEach(loan => {
                    const li = document.createElement('li');
                    li.textContent = `Book: ${loan.book_name}, Due Date: ${loan.due_date}`;
                    loansList.appendChild(li);
                });

                // Display late loans
                const lateLoansList = document.getElementById('late-loans-list');
                user.late_loans.forEach(loan => {
                    const li = document.createElement('li');
                    li.textContent = `Book: ${loan.book_name}, Due Date: ${loan.due_date}`;
                    lateLoansList.appendChild(li);
                });
            })
            .catch(error => console.error('Error fetching profile:', error));

        // Function to handle changing password
        document.getElementById('change-password-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            axios.post('http://localhost:5000/api/change_password', {
                new_password: formData.get('new_password')
            }, { headers })
            .then(response => {
                alert(response.data.message);
                // Optionally clear the form or update UI
            })
            .catch(error => console.error('Error changing password:', error));
        });

        // Function to handle changing username
        document.getElementById('change-username-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            axios.post('http://localhost:5000/api/change_username', {
                new_username: formData.get('new_username')
            }, { headers })
            .then(response => {
                alert(response.data.message);
                document.getElementById('username').textContent = formData.get('new_username');
                // Optionally clear the form or update UI
            })
            .catch(error => console.error('Error changing username:', error));
        });
    </script>
</body>
</html>
